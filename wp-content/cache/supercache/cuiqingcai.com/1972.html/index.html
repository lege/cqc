<!DOCTYPE HTML>
<html>
<head>
<meta charset="UTF-8">
<meta name="baidu-tc-verification" content="0fb041a64ee71333c957d8c784961cc8" />
<meta property="qc:admins" content="145637425211673116375" />
<meta http-equiv="X-UA-Compatible" content="IE=10,IE=9,IE=8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<title>Python爬虫实战六之抓取爱问知识人问题并保存至数据库 | 静觅</title>
<script>
window._deel = {name: '静觅',url: 'http://cuiqingcai.com/wp-content/themes/Yusi', ajaxpager: '', commenton: 1, roll: [0,0]}
</script>

<!-- All in One SEO Pack 2.2.6.2 by Michael Torbert of Semper Fi Web Design[392,438] -->
<meta name="description" itemprop="description" content="大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括： Urllib的用法及异常处理 Beautiful" />

<meta name="keywords" itemprop="keywords" content="python,爬虫" />

<!-- /all in one seo pack -->
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/blog.cuiqingcai.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.2.5"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-github-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/themes/github/github.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css?ver=2.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='page-list-style-css'  href='http://cuiqingcai.com/wp-content/plugins/sitemap/css/page-list.css?ver=4.3' type='text/css' media='all' />
<link rel='stylesheet' id='style-css'  href='http://cuiqingcai.com/wp-content/themes/Yusi/style.css?ver=33' type='text/css' media='all' />
<script type="text/javascript">
var duoshuoQuery = {"short_name":"cuiqingcai","sso":{"login":"http:\/\/blog.cuiqingcai.com\/wp-login.php?action=duoshuo_login","logout":"http:\/\/blog.cuiqingcai.com\/wp-login.php?action=logout&_wpnonce=d6fca5fc89"},"theme":"default","stylePatch":"wordpress\/\u9759\u89c5"};
duoshuoQuery.sso.login += '&redirect_to=' + encodeURIComponent(window.location.href);
duoshuoQuery.sso.logout += '&redirect_to=' + encodeURIComponent(window.location.href);
</script>
<script type="text/javascript" src="http://static.duoshuo.com/embed.js" charset="UTF-8" async="async"></script>
<script type='text/javascript' src='//libs.baidu.com/jquery/1.8.3/jquery.min.js?ver=1.0'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"2.7.1","is_admin":"0","ajaxurl":"http:\/\/blog.cuiqingcai.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"\u4f7f\u7528 %s \u590d\u5236\uff0c\u4f7f\u7528 %s \u7c98\u8d34\u3002","minimize":"\u70b9\u51fb\u5c55\u5f00\u4ee3\u7801"};
/* ]]> */
</script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=2.7.1'></script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/themes/Yusi/js/jquery.fitvids.js?ver=2.0.110526'></script>
<link rel='prev' title='Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法' href='http://blog.cuiqingcai.com/1981.html' />
<link rel='next' title='Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤' href='http://blog.cuiqingcai.com/2036.html' />
<link rel='canonical' href='http://blog.cuiqingcai.com/1972.html' />
<link rel='shortlink' href='http://blog.cuiqingcai.com/?p=1972' />
<meta name="keywords" content="Python, 爬虫, Python">
<meta name="description" content="大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括：  	Urllib的用法及异常处理 	Beautiful Soup的简单应用 	MySQLdb的基础用法 	正则表达式的简单应用  环境配置 在这之前，我们需要先配置一下环境，我的Python的版本为2.7，需要额外安装的库有两个，一个是Beautiful Soup，一个是MySQLdb，在这里附上两个库的下载地址，  Beautiful S">
        <script type="text/javascript">
            jQuery(document).ready( function() {
                jQuery('.video').fitVids();
            });
        </script><!--[if lt IE 9]><script src="http://cuiqingcai.com/wp-content/themes/Yusi/js/html5.js"></script><![endif]-->

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3ef185224776ec2561c9f7066ead4f24";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta name="360-site-verification" content="bdc579accc68a98f1258ebcce2266afa" />
<script type="text/javascript" name="baidu-tc-cerfication" data-appid="5411405" src="http://apps.bdimg.com/cloudaapi/lightapp.js"></script>
<link rel="shortcut icon" type="image/x-icon" href="http://blog.cuiqingcai.com/fav.png" />
<script type="text/javascript">
$(document).ready(function(){
	var imgs = new Array();
	imgs[0] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525111154.jpg';
	imgs[1] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525111447.jpg';
	imgs[2] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112058.jpg';
	imgs[3] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112112.jpg';
	imgs[4] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112129.jpg';
	imgs[5] = 'http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/20150525112155.jpg';
	$('.ds-avatar img[src*="cdncache"]').each(function(){
		var rand = Math.floor(Math.random()*imgs.length);
		$(this).attr("src",imgs[rand]);
	})
});
</script>
</head>
<body class="single single-post postid-1972 single-format-standard">

<header id="header" class="header">
<div class="container-inner">
 <div class="yusi-logo">
                    <a href="/">
                        <h1>
                                                        <span class="yusi-mono">静觅</span>
                                                        <span class="yusi-bloger">静静寻觅生活的美好</span>
                                                    </h1>
                    </a>
    </div>
</div>

	<div id="nav-header" class="navbar">
		
		<ul class="nav">
			<li id="menu-item-44" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-44"><a href="http://cuiqingcai.com">首页</a></li>
<li id="menu-item-14" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-14"><a href="http://blog.cuiqingcai.com/category/life">生活笔记</a>
<ul class="sub-menu">
	<li id="menu-item-19" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-19"><a href="http://blog.cuiqingcai.com/category/life/notes">个人随笔</a></li>
	<li id="menu-item-18" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-18"><a href="http://blog.cuiqingcai.com/category/life/daily">个人日记</a></li>
	<li id="menu-item-15" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-15"><a href="http://blog.cuiqingcai.com/category/life/presatation">个人展示</a></li>
</ul>
</li>
<li id="menu-item-7" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-has-children menu-item-7"><a href="http://blog.cuiqingcai.com/category/technique">技术杂谈</a>
<ul class="sub-menu">
	<li id="menu-item-9" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9"><a href="http://blog.cuiqingcai.com/category/technique/cc">C/C++</a></li>
	<li id="menu-item-11" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-11"><a href="http://blog.cuiqingcai.com/category/technique/java">Java</a></li>
	<li id="menu-item-17" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-17"><a href="http://blog.cuiqingcai.com/category/technique/php">PHP</a></li>
	<li id="menu-item-153" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-153"><a href="http://blog.cuiqingcai.com/category/technique/html">HTML</a></li>
	<li id="menu-item-960" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-960"><a href="http://blog.cuiqingcai.com/category/technique/python">Python</a></li>
	<li id="menu-item-1277" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1277"><a href="http://blog.cuiqingcai.com/category/technique/javascript">JS</a></li>
	<li id="menu-item-16" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-16"><a href="http://blog.cuiqingcai.com/category/technique/other">Other</a></li>
</ul>
</li>
<li id="menu-item-418" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-418"><a href="http://blog.cuiqingcai.com/category/resources">福利专区</a></li>
<li id="menu-item-851" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-851"><a href="http://blog.cuiqingcai.com/about">关于自己</a></li>
<li id="menu-item-251" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-251"><a href="http://blog.cuiqingcai.com/contact">给我留言</a></li>
<li id="menu-item-1131" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1131"><a href="http://blog.cuiqingcai.com/donate">赞助作者</a></li>
<li style="float:right;">
                    <div class="toggle-search"><i class="fa fa-search"></i></div>
<div class="search-expand" style="display: none;"><div class="search-expand-inner"><form method="get" class="searchform themeform" onsubmit="location.href='http://blog.cuiqingcai.com/?s=' + encodeURIComponent(this.s.value).replace(/%20/g, '+'); return false;" action="/"><div> <input type="ext" class="search" name="s" onblur="if(this.value=='')this.value='search...';" onfocus="if(this.value=='search...')this.value='';" value="search..."></div></form></div></div>
</li>
		</ul>
	</div>
	</div>
</header>
<section class="container"><div class="speedbar">
					<div class="pull-right">
				<i class="fa fa-user"></i> <a href="/wp-login.php?action=register">投稿</a>&nbsp;&nbsp;&nbsp;   <i class="fa fa-power-off"></i> <a href="http://blog.cuiqingcai.com/wp-login.php">登录</a>			</div>
				<div class="toptip"><strong class="text-success"><i class="fa fa-volume-up"></i> </strong>    欢迎来到我的博客，浏览文章时点击一下广告是您对我最大的支持，谢谢啦！</div>
	</div>
	<div class="content-wrap">
	<div class="content">
<div class="breadcrumbs"><a title="返回首页" href="http://blog.cuiqingcai.com"><i class="fa fa-home"></i></a> <small>></small> <a href="http://blog.cuiqingcai.com/category/technique">技术杂谈</a> <small>></small> <a href="http://blog.cuiqingcai.com/category/technique/python">Python</a> <small>></small> <span class="muted">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</span></div>
				<header class="article-header">
			<h1 class="article-title"><a href="http://blog.cuiqingcai.com/1972.html">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a></h1>
			<div class="meta">
				<span id="mute-category" class="muted"><i class="fa fa-list-alt"></i><a href="http://blog.cuiqingcai.com/category/technique/python"> Python</a></span>				<span class="muted"><i class="fa fa-user"></i> <a href="http://blog.cuiqingcai.com/author/cqcre">崔庆才</a></span>
				<time class="muted"><i class="fa fa-clock-o"></i> 2个月前 (09-08)</time>
				<span class="muted"><i class="fa fa-eye"></i> 3450℃</span>
				<span class="muted"><i class="fa fa-comments-o"></i> <a href="http://blog.cuiqingcai.com/1972.html#comments">3评论</a></span>							</div>
		</header>
<div class="banner banner-post"><!-- tuici -->
<script type="text/javascript">
    /* 创建于 2015-02-23*/
var cpro_id = "u1959022";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/cnw.js" type="text/javascript"></script>
<!-- biaoqian -->
<script type="text/javascript">
    /*860*60 创建于 2015-02-25*/
    var cpro_id = "u1959939";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>

</div>		<article class="article-content">
			<p>大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括：</p>
<ul>
<li>Urllib的用法及异常处理</li>
<li>Beautiful Soup的简单应用</li>
<li>MySQLdb的基础用法</li>
<li>正则表达式的简单应用</li>
</ul>
<h2>环境配置</h2>
<p>在这之前，我们需要先配置一下环境，我的Python的版本为2.7，需要额外安装的库有两个，一个是Beautiful Soup，一个是MySQLdb，在这里附上两个库的下载地址，</p>
<p><a class="dl link" href="https://pypi.python.org/pypi/beautifulsoup4/4.3.2">Beautiful Soup</a>     <a class="dl link" href="http://sourceforge.net/projects/mysql-python/">MySQLdb</a></p>
<p>大家可以下载之后通过如下命令安装</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946a9104023351" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
python setup.py install</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946a9104023351-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946a9104023351-1"><span class="crayon-e">python </span><span class="crayon-v">setup</span><span class="crayon-sy">.</span><span class="crayon-e">py </span><span class="crayon-v">install</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>环境配置好之后，我们便可以开心地撸爬虫了</p>
<h2>框架思路</h2>
<p>首先我们随便找一个分类地址，<a href="http://iask.sina.com.cn/c/978-all-1.html">外语学习 &#8211; 爱问知识人</a>，打开之后可以看到一系列的问题列表。</p>
<p>我们在这个页面需要获取的东西有：</p>
<p>总的页码数，每一页的所有问题链接。</p>
<p>接下来我们需要遍历所有的问题，来抓取每一个详情页面，提取问题，问题内容，回答者，回答时间，回答内容。</p>
<p>最后，我们需要把这些内容存储到数据库中。</p>
<h2>要点简析</h2>
<p>其实大部分内容相信大家会了前面的内容，这里的爬虫思路已经融汇贯通了，这里就说一下一些扩展的功能</p>
<h3>1.日志输出</h3>
<p>日志输出，我们要输出时间和爬取的状态，比如像下面这样：</p>
<blockquote><p>[2015-08-10 03:05:20] 113011 号问题存在其他答案 我个人认为应该是樱桃沟很美的</p>
<p>[2015-08-10 03:05:20] 保存到数据库,此问题的ID为 113011</p>
<p>[2015-08-10 03:05:20] 当前爬取第 2 的内容,发现一个问题 百度有一个地方，花儿带着芳香，水儿流淌奔腾是什么意思 多多帮忙哦 回答数量 1</p>
<p>[2015-08-10 03:05:19] 保存到数据库,此问题的ID为 113010</p></blockquote>
<p>所以，我们需要引入时间函数，然后写一个获取当前时间的函数</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946b9155804105" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import time

#获取当前时间
def getCurrentTime(self):
    return time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))
    
#获取当前时间
def getCurrentDate(self):
    return time.strftime('%Y-%m-%d',time.localtime(time.time()))</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946b9155804105-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946b9155804105-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946b9155804105-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946b9155804105-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946b9155804105-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946b9155804105-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946b9155804105-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946b9155804105-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946b9155804105-9">9</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946b9155804105-1"><span class="crayon-e">import </span><span class="crayon-v">time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946b9155804105-2">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e946b9155804105-3"><span class="crayon-p">#获取当前时间</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946b9155804105-4"><span class="crayon-e">def </span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946b9155804105-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'[%Y-%m-%d %H:%M:%S]'</span><span class="crayon-sy">,</span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946b9155804105-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e946b9155804105-7"><span class="crayon-p">#获取当前时间</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946b9155804105-8"><span class="crayon-e">def </span><span class="crayon-e">getCurrentDate</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946b9155804105-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'%Y-%m-%d'</span><span class="crayon-sy">,</span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-v">time</span><span class="crayon-sy">.</span><span class="crayon-e">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>以上分别是获取带具体时间和获取日期的函数，在输出时，我们可以在输出语句的前面调用这函数即可。</p>
<p>然后我们需要将缓冲区设置输出到log中，在程序的最前面加上这两句即可</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946bf612051256" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
f_handler=open('out.log', 'w') 
sys.stdout=f_handler</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946bf612051256-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946bf612051256-2">2</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946bf612051256-1"><span class="crayon-v">f_handler</span><span class="crayon-o">=</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">'out.log'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946bf612051256-2"><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-o">=</span><span class="crayon-v">f_handler</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0004 seconds] -->
<p>这样，所有的print语句输出的内容就会保存到out.log文件中了。</p>
<h3>2.页码保存</h3>
<p>爬虫爬取过程中可能出现各种各样的错误，这样会导致爬虫的中断，如果我们重新运行爬虫，那么就会导致爬虫从头开始运行了，这样显然是不合理的。所以，我们需要把当前爬取的页面保存下来，比如可以保存到文本中，假如爬虫中断了，重新运行爬虫，读取文本文件的内容，接着爬取即可。</p>
<p>大家可以稍微参考一下函数的实现：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946c4377642499" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
    #主函数
    def main(self):
        f_handler=open('out.log', 'w') 
        sys.stdout=f_handler
        page = open('page.txt', 'r')
        content = page.readline()
        start_page = int(content.strip()) - 1
        page.close()     
        print self.getCurrentTime(),"开始页码",start_page
        print self.getCurrentTime(),"爬虫正在启动,开始爬取爱问知识人问题"
        self.total_num = self.getTotalPageNum()
        print self.getCurrentTime(),"获取到目录页面个数",self.total_num,"个"
        if not start_page:
            start_page = self.total_num
        for x in range(1,start_page):
            print self.getCurrentTime(),"正在抓取第",start_page-x+1,"个页面"
            try:
                self.getQuestions(start_page-x+1)
            except urllib2.URLError, e:
                if hasattr(e, "reason"):
                    print self.getCurrentTime(),"某总页面内抓取或提取失败,错误原因", e.reason
            except Exception,e:  
                print self.getCurrentTime(),"某总页面内抓取或提取失败,错误原因:",e
            if start_page-x+1 &lt; start_page:
                f=open('page.txt','w')
                f.write(str(start_page-x+1))
                print self.getCurrentTime(),"写入新页码",start_page-x+1
                f.close()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-16">16</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-18">18</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-20">20</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-22">22</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-24">24</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-26">26</div><div class="crayon-num" data-line="crayon-5645b71e946c4377642499-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946c4377642499-28">28</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946c4377642499-1"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#主函数</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">f_handler</span><span class="crayon-o">=</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">'out.log'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">sys</span><span class="crayon-sy">.</span><span class="crayon-v">stdout</span><span class="crayon-o">=</span><span class="crayon-e">f_handler</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-5"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">'page.txt'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">content</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">page</span><span class="crayon-sy">.</span><span class="crayon-e">readline</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">start_page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">int</span><span class="crayon-sy">(</span><span class="crayon-v">content</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">page</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"开始页码"</span><span class="crayon-sy">,</span><span class="crayon-e">start_page</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-10"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"爬虫正在启动,开始爬取爱问知识人问题"</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">total_num</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getTotalPageNum</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"获取到目录页面个数"</span><span class="crayon-sy">,</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">total_num</span><span class="crayon-sy">,</span><span class="crayon-s">"个"</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">start_page</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">start_page</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">total_num</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-15"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">x</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">range</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-v">start_page</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"正在抓取第"</span><span class="crayon-sy">,</span><span class="crayon-v">start_page</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">,</span><span class="crayon-s">"个页面"</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getQuestions</span><span class="crayon-sy">(</span><span class="crayon-v">start_page</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">urllib2</span><span class="crayon-sy">.</span><span class="crayon-v">URLError</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-e">hasattr</span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"reason"</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"某总页面内抓取或提取失败,错误原因"</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-e">reason</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-22"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">except </span><span class="crayon-v">Exception</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"某总页面内抓取或提取失败,错误原因:"</span><span class="crayon-sy">,</span><span class="crayon-i">e</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">start_page</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-o">&lt;</span><span class="crayon-h"> </span><span class="crayon-v">start_page</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">f</span><span class="crayon-o">=</span><span class="crayon-e">open</span><span class="crayon-sy">(</span><span class="crayon-s">'page.txt'</span><span class="crayon-sy">,</span><span class="crayon-s">'w'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">write</span><span class="crayon-sy">(</span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">start_page</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946c4377642499-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"写入新页码"</span><span class="crayon-sy">,</span><span class="crayon-v">start_page</span><span class="crayon-o">-</span><span class="crayon-v">x</span><span class="crayon-o">+</span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946c4377642499-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">f</span><span class="crayon-sy">.</span><span class="crayon-e">close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0066 seconds] -->
<p>这样，不管我们爬虫中途遇到什么错误，妈妈也不会担心了</p>
<h3>3.页面处理</h3>
<p>页面处理过程中，我们可能遇到各种各样奇葩的HTML代码，和上一节一样，我们沿用一个页面处理类即可。</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946cb696514419" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
import re

#处理页面标签类
class Tool:
    
    #将超链接广告剔除
    removeADLink = re.compile('&lt;div class="link_layer.*?&lt;/div&gt;')
    #去除img标签,1-7位空格,&amp;nbsp;
    removeImg = re.compile('&lt;img.*?&gt;| {1,7}|&amp;nbsp;')
    #删除超链接标签
    removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;')
    #把换行的标签换为\n
    replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;')
    #将表格制表&lt;td&gt;替换为\t
    replaceTD= re.compile('&lt;td&gt;')
    #将换行符或双换行符替换为\n
    replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;')
    #将其余标签剔除
    removeExtraTag = re.compile('&lt;.*?&gt;')
    #将多行空行删除
    removeNoneLine = re.compile('\n+')
    
    def replace(self,x):
        x = re.sub(self.removeADLink,"",x)
        x = re.sub(self.removeImg,"",x)
        x = re.sub(self.removeAddr,"",x)
        x = re.sub(self.replaceLine,"\n",x)
        x = re.sub(self.replaceTD,"\t",x)
        x = re.sub(self.replaceBR,"\n",x)
        x = re.sub(self.removeExtraTag,"",x)
        x = re.sub(self.removeNoneLine,"\n",x)
        #strip()将前后多余内容删除
        return x.strip()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-16">16</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-18">18</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-20">20</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-22">22</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-24">24</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-26">26</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-28">28</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-30">30</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946cb696514419-32">32</div><div class="crayon-num" data-line="crayon-5645b71e946cb696514419-33">33</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946cb696514419-1"><span class="crayon-e">import </span><span class="crayon-v">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-2">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e946cb696514419-3"><span class="crayon-p">#处理页面标签类</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-4"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Tool</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将超链接广告剔除</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeADLink</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div class="link_layer.*?&lt;/div&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#去除img标签,1-7位空格,&amp;nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img.*?&gt;| {1,7}|&amp;nbsp;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#删除超链接标签</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;a.*?&gt;|&lt;/a&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#把换行的标签换为\n</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将表格制表&lt;td&gt;替换为\t</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceTD</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;td&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将换行符或双换行符替换为\n</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceBR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将其余标签剔除</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeExtraTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;.*?&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#将多行空行删除</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeNoneLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'\n+'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">replace</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeADLink</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeImg</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeAddr</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceLine</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceTD</span><span class="crayon-sy">,</span><span class="crayon-s">"\t"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">replaceBR</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeExtraTag</span><span class="crayon-sy">,</span><span class="crayon-s">""</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">x</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">re</span><span class="crayon-sy">.</span><span class="crayon-e">sub</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">removeNoneLine</span><span class="crayon-sy">,</span><span class="crayon-s">"\n"</span><span class="crayon-sy">,</span><span class="crayon-v">x</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946cb696514419-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-p">#strip()将前后多余内容删除</span></div><div class="crayon-line" id="crayon-5645b71e946cb696514419-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">x</span><span class="crayon-sy">.</span><span class="crayon-e">strip</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0061 seconds] -->
<p>我们可以用一段含有HTML代码的文字，经过调用replace方法之后，各种冗余的HTML代码就会处理好了。</p>
<p>比如我们这么一段代码：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946d1936367365" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;article class="article-content"&gt;
&lt;h2&gt;前言&lt;/h2&gt;
&lt;p&gt;最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。&lt;/p&gt;
&lt;p&gt;好了，闲言碎语不多讲，开始我们的配置之旅。&lt;/p&gt;
&lt;p&gt;运行环境：&lt;strong&gt;Ubuntu Linux 14.04&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;编写Shell脚本&lt;/h2&gt;
&lt;p&gt;首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下：&lt;/p&gt;
&lt;p&gt;显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。&lt;/p&gt;
&lt;p&gt;可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下&lt;/p&gt;
&lt;p&gt;&lt;a href="http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" data-original-title="" title=""&gt;Ubuntu Shell 编程基础&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。&lt;/p&gt;
&lt;p&gt;执行如下命令：&lt;/p&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946d1936367365-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d1936367365-12">12</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946d1936367365-1"><span class="crayon-o">&lt;</span><span class="crayon-e">article </span><span class="crayon-t">class</span><span class="crayon-o">=</span><span class="crayon-s">"article-content"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-2"><span class="crayon-o">&lt;</span><span class="crayon-v">h2</span><span class="crayon-o">&gt;</span>前言<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h2</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946d1936367365-3"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>最近发现<span class="crayon-i">MySQL</span>服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于<span class="crayon-i">MySQL</span>，在做爬虫存取一些资料的时候也是基于<span class="crayon-i">MySQL</span>，数据量一大了，<span class="crayon-i">MySQL</span>它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的<span class="crayon-i">MySQL</span>，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-4"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>好了，闲言碎语不多讲，开始我们的配置之旅。<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946d1936367365-5"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>运行环境：<span class="crayon-o">&lt;</span><span class="crayon-v">strong</span><span class="crayon-o">&gt;</span><span class="crayon-e">Ubuntu </span><span class="crayon-i">Linux</span><span class="crayon-h"> </span><span class="crayon-cn">14.04</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">strong</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-6"><span class="crayon-o">&lt;</span><span class="crayon-v">h2</span><span class="crayon-o">&gt;</span>编写<span class="crayon-i">Shell</span>脚本<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">h2</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946d1936367365-7"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>首先，我们要编写一个<span class="crayon-i">shell</span>脚本，脚本主要执行的逻辑如下：<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-8"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>显示<span class="crayon-i">mysqld</span>进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动<span class="crayon-i">mysql</span>服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946d1936367365-9"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>可能大家对于<span class="crayon-i">shell</span>脚本比较陌生，在这里推荐官方的<span class="crayon-i">shell</span>脚本文档来参考一下<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-10"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-i">a</span><span class="crayon-h"> </span><span class="crayon-v">href</span><span class="crayon-o">=</span><span class="crayon-s">"http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80"</span><span class="crayon-h"> </span><span class="crayon-v">data</span><span class="crayon-o">-</span><span class="crayon-v">original</span><span class="crayon-o">-</span><span class="crayon-v">title</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-h"> </span><span class="crayon-v">title</span><span class="crayon-o">=</span><span class="crayon-s">""</span><span class="crayon-o">&gt;</span><span class="crayon-e">Ubuntu </span><span class="crayon-i">Shell</span><span class="crayon-h"> </span>编程基础<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">a</span><span class="crayon-o">&gt;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946d1936367365-11"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span><span class="crayon-i">shell</span>脚本的后缀为<span class="crayon-i">sh</span>，在任何位置新建一个脚本文件，我选择在<span class="crayon-h"> </span><span class="crayon-o">/</span><span class="crayon-v">etc</span><span class="crayon-o">/</span><span class="crayon-i">mysql</span><span class="crayon-h"> </span>目录下新建一个<span class="crayon-h"> </span><span class="crayon-v">listen</span><span class="crayon-sy">.</span><span class="crayon-i">sh</span><span class="crayon-h"> </span>文件。<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d1936367365-12"><span class="crayon-o">&lt;</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span>执行如下命令：<span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">p</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0068 seconds] -->
<p>经过处理后便会变成如下的样子：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946d8096550084" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
前言
最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。
好了，闲言碎语不多讲，开始我们的配置之旅。
运行环境：UbuntuLinux14.04
编写Shell脚本
首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下：
显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。
可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下
UbuntuShell编程基础
shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在/etc/mysql目录下新建一个listen.sh文件。
执行如下命令：</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d8096550084-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d8096550084-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d8096550084-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d8096550084-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946d8096550084-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946d8096550084-11">11</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946d8096550084-1">前言</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d8096550084-2">最近发现<span class="crayon-i">MySQL</span>服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于<span class="crayon-i">MySQL</span>，在做爬虫存取一些资料的时候也是基于<span class="crayon-i">MySQL</span>，数据量一大了，<span class="crayon-i">MySQL</span>它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的<span class="crayon-i">MySQL</span>，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。</div><div class="crayon-line" id="crayon-5645b71e946d8096550084-3">好了，闲言碎语不多讲，开始我们的配置之旅。</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d8096550084-4">运行环境：<span class="crayon-v">UbuntuLinux14</span><span class="crayon-sy">.</span><span class="crayon-cn">04</span></div><div class="crayon-line" id="crayon-5645b71e946d8096550084-5">编写<span class="crayon-i">Shell</span>脚本</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d8096550084-6">首先，我们要编写一个<span class="crayon-i">shell</span>脚本，脚本主要执行的逻辑如下：</div><div class="crayon-line" id="crayon-5645b71e946d8096550084-7">显示<span class="crayon-i">mysqld</span>进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动<span class="crayon-i">mysql</span>服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d8096550084-8">可能大家对于<span class="crayon-i">shell</span>脚本比较陌生，在这里推荐官方的<span class="crayon-i">shell</span>脚本文档来参考一下</div><div class="crayon-line" id="crayon-5645b71e946d8096550084-9"><span class="crayon-i">UbuntuShell</span>编程基础</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946d8096550084-10"><span class="crayon-i">shell</span>脚本的后缀为<span class="crayon-i">sh</span>，在任何位置新建一个脚本文件，我选择在<span class="crayon-o">/</span><span class="crayon-v">etc</span><span class="crayon-o">/</span><span class="crayon-i">mysql</span>目录下新建一个<span class="crayon-v">listen</span><span class="crayon-sy">.</span><span class="crayon-i">sh</span>文件。</div><div class="crayon-line" id="crayon-5645b71e946d8096550084-11">执行如下命令：</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0043 seconds] -->
<p>经过上面的处理，所有乱乱的代码都会被处理好了。</p>
<h3>4.保存到数据库</h3>
<p>在这里，我们想实现一个通用的方法，就是把存储的一个个内容变成字典的形式，然后执行插入语句的时候，自动构建对应的sql语句，插入数据。</p>
<p>比如我们构造如下的字典：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946df204396716" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#构造最佳答案的字典
good_ans_dict = {
        "text": good_ans[0],
        "answerer": good_ans[1],
        "date": good_ans[2],
        "is_good": str(good_ans[3]),
        "question_id": str(insert_id)
        }</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946df204396716-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946df204396716-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946df204396716-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946df204396716-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946df204396716-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946df204396716-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946df204396716-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946df204396716-8">8</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946df204396716-1"><span class="crayon-p">#构造最佳答案的字典</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946df204396716-2"><span class="crayon-v">good_ans_dict</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5645b71e946df204396716-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"text"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">good_ans</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946df204396716-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"answerer"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">good_ans</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5645b71e946df204396716-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"date"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">good_ans</span><span class="crayon-sy">[</span><span class="crayon-cn">2</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946df204396716-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"is_good"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">good_ans</span><span class="crayon-sy">[</span><span class="crayon-cn">3</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5645b71e946df204396716-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"question_id"</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-e">str</span><span class="crayon-sy">(</span><span class="crayon-v">insert_id</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946df204396716-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0014 seconds] -->
<p>构造sql语句并插入到数据库的方法如下：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946e5262835376" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#插入数据
    def insertData(self, table, my_dict):
         try:
             self.db.set_character_set('utf8')
             cols = ', '.join(my_dict.keys())
             values = '"," '.join(my_dict.values())
             sql = "INSERT INTO %s (%s) VALUES (%s)" % (table, cols, '"'+values+'"')
             try:
                 result = self.cur.execute(sql)
                 insert_id = self.db.insert_id()
                 self.db.commit()
                 #判断是否执行成功
                 if result:
                     return insert_id
                 else:
                     return 0
             except MySQLdb.Error,e:
                 #发生错误时回滚
                 self.db.rollback()
                 #主键唯一，无法插入
                 if "key 'PRIMARY'" in e.args[1]:
                     print self.getCurrentTime(),"数据已存在，未插入数据"
                 else:
                     print self.getCurrentTime(),"插入数据失败，原因 %d: %s" % (e.args[0], e.args[1])
         except MySQLdb.Error,e:
             print self.getCurrentTime(),"数据库错误，原因%d: %s" % (e.args[0], e.args[1])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-16">16</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-18">18</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-20">20</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-22">22</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-24">24</div><div class="crayon-num" data-line="crayon-5645b71e946e5262835376-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946e5262835376-26">26</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946e5262835376-1"><span class="crayon-p">#插入数据</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">def </span><span class="crayon-e">insertData</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">my_dict</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">set_character_set</span><span class="crayon-sy">(</span><span class="crayon-s">'utf8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">my_dict</span><span class="crayon-sy">.</span><span class="crayon-e">keys</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'"," '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">my_dict</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"INSERT INTO %s (%s) VALUES (%s)"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'"'</span><span class="crayon-o">+</span><span class="crayon-v">values</span><span class="crayon-o">+</span><span class="crayon-s">'"'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">cur</span><span class="crayon-sy">.</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-v">sql</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">insert_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">insert_id</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-p">#判断是否执行成功</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">insert_id</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-15"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">except </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-v">Error</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-p">#发生错误时回滚</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">rollback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-p">#主键唯一，无法插入</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-s">"key 'PRIMARY'"</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"数据已存在，未插入数据"</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"插入数据失败，原因 %d: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946e5262835376-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">except </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-v">Error</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946e5262835376-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-e">print </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"数据库错误，原因%d: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0055 seconds] -->
<p>这里我们只需要传入那个字典，便会构建出对应字典键值和键名的sql语句，完成插入。</p>
<h3>5.PHP读取日志</h3>
<p>我们将运行结果输出到了日志里，那么怎么查看日志呢？很简单，在这里提供两种方法</p>
<p>方法一：</p>
<p>PHP倒序输出所有日志内容</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946eb716790203" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="含多种语言"></span><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">PHP</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;meta http-equiv="refresh" content = "5"&gt; 
    &lt;/head&gt;
    &lt;body&gt;
        &lt;?php
            $fp = file("out.log");
            if ($fp) {
                for($i = count($fp) - 1;$i &gt;= 0; $i --) 
                echo $fp[$i]."&lt;br&gt;";
            }
        ?&gt;
    &lt;/body&gt;
&lt;/html&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946eb716790203-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946eb716790203-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946eb716790203-1"><span class="crayon-o">&lt;</span><span class="crayon-i">html</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-i">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-i">charset</span><span class="crayon-o">=</span><span class="crayon-s">"utf-8"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-i">http</span><span class="crayon-o">-</span><span class="crayon-i">equiv</span><span class="crayon-o">=</span><span class="crayon-s">"refresh"</span><span class="crayon-h"> </span><span class="crayon-i">content</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"5"</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-ta">&lt;?php</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$fp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">file</span><span class="crayon-sy">(</span><span class="crayon-s">"out.log"</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">$fp</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-sy">(</span><span class="crayon-v">$i</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">count</span><span class="crayon-sy">(</span><span class="crayon-v">$fp</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">-</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-sy">;</span><span class="crayon-v">$i</span><span class="crayon-h"> </span><span class="crayon-o">&gt;=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span><span class="crayon-sy">;</span><span class="crayon-h"> </span><span class="crayon-v">$i</span><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$fp</span><span class="crayon-sy">[</span><span class="crayon-v">$i</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-s">"&lt;br&gt;"</span><span class="crayon-sy">;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-ta">?&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946eb716790203-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946eb716790203-15"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-i">html</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0036 seconds] -->
<p>此方法可以看到所有的输入日志，但是如果日志太大了，那么就会报耗费内存太大，无法输出。为此我们就有了第二种方法，利用linux命令，输出后十行内容。</p>
<p>方法二：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946f1512814485" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-mixed-highlight" title="含多种语言"></span><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;meta http-equiv="refresh" content = "5"&gt; 
    &lt;/head&gt;
    &lt;body&gt;
		&lt;?php 
			$ph = popen('tail -n 100 out.log','r');
			while($r = fgets($ph)){
				echo $r."&lt;br&gt;";
			}
			pclose($ph);
		?&gt;
	&lt;/body&gt;
&lt;/html&gt;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946f1512814485-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946f1512814485-15">15</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946f1512814485-1"><span class="crayon-o">&lt;</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-2"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-v">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-v">charset</span><span class="crayon-o">=</span><span class="crayon-s">"utf-8"</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">meta </span><span class="crayon-v">http</span><span class="crayon-o">-</span><span class="crayon-v">equiv</span><span class="crayon-o">=</span><span class="crayon-s">"refresh"</span><span class="crayon-h"> </span><span class="crayon-v">content</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"5"</span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-5"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-e">head</span><span class="crayon-o">&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-e">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-ta">&lt;?php</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">$ph</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">popen</span><span class="crayon-sy">(</span><span class="crayon-s">'tail -n 100 out.log'</span><span class="crayon-sy">,</span><span class="crayon-s">'r'</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-sy">(</span><span class="crayon-v">$r</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">fgets</span><span class="crayon-sy">(</span><span class="crayon-v">$ph</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">echo</span><span class="crayon-h"> </span><span class="crayon-v">$r</span><span class="crayon-sy">.</span><span class="crayon-s">"&lt;br&gt;"</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">pclose</span><span class="crayon-sy">(</span><span class="crayon-v">$ph</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-ta">?&gt;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946f1512814485-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">body</span><span class="crayon-o">&gt;</span></div><div class="crayon-line" id="crayon-5645b71e946f1512814485-15"><span class="crayon-o">&lt;</span><span class="crayon-o">/</span><span class="crayon-v">html</span><span class="crayon-o">&gt;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0025 seconds] -->
<p>上面两种方法都是5秒刷新一次网页来查看最新的日志。</p>
<h2>源代码放送</h2>
<p>好了，闲言碎语不多讲，直接上源码了</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946f6400045114" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
spider.py</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946f6400045114-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946f6400045114-1"><span class="crayon-v">spider</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e946fb284406606" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# -*- coding:utf-8 -*-

import urllib
import urllib2
import re
import time
import types
import page
import mysql
import sys
from bs4 import BeautifulSoup

class Spider:
    
    #初始化
    def __init__(self):
        self.page_num = 1
        self.total_num = None
        self.page_spider = page.Page()
        self.mysql = mysql.Mysql()
        
    #获取当前时间
    def getCurrentTime(self):
        return time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))
    
    #获取当前时间
    def getCurrentDate(self):
        return time.strftime('%Y-%m-%d',time.localtime(time.time()))
    
    #通过网页的页码数来构建网页的URL
    def getPageURLByNum(self, page_num):
        page_url = "http://iask.sina.com.cn/c/978-all-" + str(page_num) + ".html"
        return page_url
    
    
    #通过传入网页页码来获取网页的HTML
    def getPageByNum(self, page_num):
        request = urllib2.Request(self.getPageURLByNum(page_num))
        try:
            response = urllib2.urlopen(request)
        except urllib2.URLError, e:
            if hasattr(e, "code"):
                print self.getCurrentTime(),"获取页面失败,错误代号", e.code
                return None
            if hasattr(e, "reason"):
                print self.getCurrentTime(),"获取页面失败,原因", e.reason
                return None
        else:
            page =  response.read().decode("utf-8")
            return page
    
    #获取所有的页码数
    def getTotalPageNum(self):
        print self.getCurrentTime(),"正在获取目录页面个数,请稍候"
        page = self.getPageByNum(1)
        #匹配所有的页码数,\u4e0b\u4e00\u9875是下一页的UTF8编码
        pattern = re.compile(u'&lt;span class="more".*?&gt;.*?&lt;span.*?&lt;a href.*?class=""&gt;(.*?)&lt;/a&gt;\s*&lt;a.*?\u4e0b\u4e00\u9875&lt;/a&gt;', re.S)
        match = re.search(pattern, page)
        if match:
            return match.group(1)
        else:
            print self.getCurrentTime(),"获取总页码失败"
    
    #分析问题的代码,得到问题的提问者,问题内容,回答个数,提问时间
    def getQuestionInfo(self, question):
        if not type(question) is types.StringType:
            question = str(question)
        #print question
        pattern = re.compile(u'&lt;span.*?question-face.*?&gt;.*?&lt;img.*?alt="(.*?)".*?&lt;/span&gt;.*?&lt;a href="(.*?)".*?&gt;(.*?)&lt;/a&gt;.*?answer_num.*?&gt;(\d*).*?&lt;/span&gt;.*?answer_time.*?&gt;(.*?)&lt;/span&gt;', re.S)
        match = re.search(pattern, question)
        if match:
            #获得提问者
            author = match.group(1)
            #问题链接
            href = match.group(2)
            #问题详情
            text = match.group(3)
            #回答个数
            ans_num = match.group(4)
            #回答时间
            time = match.group(5)
            time_pattern = re.compile('\d{4}\-\d{2}\-\d{2}', re.S)
            time_match = re.search(time_pattern, time)
            if not time_match:
                time = self.getCurrentDate()
            return [author, href, text, ans_num, time]
        else:
            return None
        
    #获取全部问题
    def getQuestions(self, page_num):
        #获得目录页面的HTML
        page = self.getPageByNum(page_num)
        soup = BeautifulSoup(page)
        #分析获得所有问题
        questions = soup.select("div.question_list ul li")
        #遍历每一个问题
        for question in questions:
            #获得问题的详情
            info = self.getQuestionInfo(question)
            if info:
                #得到问题的URL
                url = "http://iask.sina.com.cn/" + info[1]
                #通过URL来获取问题的最佳答案和其他答案
                ans = self.page_spider.getAnswer(url)
                print self.getCurrentTime(),"当前爬取第",page_num,"的内容,发现一个问题",info[2],"回答数量",info[3]
                #构造问题的字典,插入问题
                ques_dict = {
                            "text": info[2],
                            "questioner": info[0],
                            "date": info[4],
                            "ans_num": info[3],
                            "url": url
                            }
                #获得插入的问题的自增ID 
                insert_id = self.mysql.insertData("iask_questions",ques_dict)
                #得到最佳答案
                good_ans = ans[0]
                print self.getCurrentTime(),"保存到数据库,此问题的ID为",insert_id
                #如果存在最佳答案,那么就插入
                if good_ans:
                    print self.getCurrentTime(),insert_id,"号问题存在最佳答案",good_ans[0]
                    #构造最佳答案的字典
                    good_ans_dict = {
                            "text": good_ans[0],
                            "answerer": good_ans[1],
                            "date": good_ans[2],
                            "is_good": str(good_ans[3]),
                            "question_id": str(insert_id)
                            }
                    #插入最佳答案
                    if self.mysql.insertData("iask_answers",good_ans_dict):
                        print self.getCurrentTime(),"保存最佳答案成功"
                    else:
                        print self.getCurrentTime(),"保存最佳答案失败"
                #获得其他答案
                other_anses = ans[1]
                #遍历每一个其他答案
                for other_ans in other_anses:
                    #如果答案存在
                    if other_ans:
                        print self.getCurrentTime(),insert_id,"号问题存在其他答案",other_ans[0]
                        #构造其他答案的字典
                        other_ans_dict = {
                                "text": other_ans[0],
                                "answerer": other_ans[1],
                                "date": other_ans[2],
                                "is_good": str(other_ans[3]),
                                "question_id": str(insert_id)
                                }
                        #插入这个答案
                        if self.mysql.insertData("iask_answers",other_ans_dict):
                            print self.getCurrentTime(),"保存其他答案成功"
                        else:
                            print self.getCurrentTime(),"保存其他答案失败"
        
    #主函数
    def main(self):
        f_handler=open('out.log', 'w') 
        sys.stdout=f_handler
        page = open('page.txt', 'r')
        content = page.readline()
        start_page = int(content.strip()) - 1
        page.close()     
        print self.getCurrentTime(),"开始页码",start_page
        print self.getCurrentTime(),"爬虫正在启动,开始爬取爱问知识人问题"
        self.total_num = self.getTotalPageNum()
        print self.getCurrentTime(),"获取到目录页面个数",self.total_num,"个"
        if not start_page:
            start_page = self.total_num
        for x in range(1,start_page):
            print self.getCurrentTime(),"正在抓取第",start_page-x+1,"个页面"
            try:
                self.getQuestions(start_page-x+1)
            except urllib2.URLError, e:
                if hasattr(e, "reason"):
                    print self.getCurrentTime(),"某总页面内抓取或提取失败,错误原因", e.reason
            except Exception,e:  
                print self.getCurrentTime(),"某总页面内抓取或提取失败,错误原因:",e
            if start_page-x+1 &lt; start_page:
                f=open('page.txt','w')
                f.write(str(start_page-x+1))
                print self.getCurrentTime(),"写入新页码",start_page-x+1
                f.close()

spider = Spider()
spider.main()       </textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-2">2</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-4">4</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-6">6</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-8">8</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-10">10</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-12">12</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-14">14</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-16">16</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-18">18</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-20">20</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-22">22</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-24">24</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-26">26</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-28">28</div><div class="crayon-num" data-line="crayon-5645b71e946fb284406606-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e946fb284406606-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e946fb284406606-1"><span class="crayon-c"># -*- coding:utf-8 -*-</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-2">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e946fb284406606-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib2</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">types</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-8"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">page</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">mysql</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-10"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">sys</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-11"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">bs4 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">BeautifulSoup</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-12">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e946fb284406606-13"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Spider</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#初始化</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">page_num</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">total_num</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">None</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">page_spider</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">page</span><span class="crayon-sy">.</span><span class="crayon-e">Page</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">mysql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-e">Mysql</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#获取当前时间</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'[%Y-%m-%d %H:%M:%S]'</span><span class="crayon-sy">,</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#获取当前时间</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getCurrentDate</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'%Y-%m-%d'</span><span class="crayon-sy">,</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e946fb284406606-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e946fb284406606-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#通过网页的页码数来构建网页的URL</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0422 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e94708536825583" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
page.py</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e94708536825583-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e94708536825583-1"><span class="crayon-v">page</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e9470e864033895" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# -*- coding:utf-8 -*-
import urllib
import urllib2
import re
import time
import types 
import tool
from bs4 import BeautifulSoup

#抓取分析某一问题和答案
class Page:
    
    def __init__(self):
        self.tool = tool.Tool()
    
    #获取当前时间
    def getCurrentDate(self):
        return time.strftime('%Y-%m-%d',time.localtime(time.time()))
    
    #获取当前时间
    def getCurrentTime(self):
        return time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))

    #通过页面的URL来获取页面的代码
    def getPageByURL(self, url):
        try:
            request = urllib2.Request(url)
            response = urllib2.urlopen(request)
            return response.read().decode("utf-8") 
        except urllib2.URLError, e:
            if hasattr(e, "code"):
                print self.getCurrentTime(),"获取问题页面失败,错误代号", e.code
                return None
            if hasattr(e, "reason"):
                print self.getCurrentTime(),"获取问题页面失败,原因", e.reason
                return None

    
    #传入一个List,返回它的标签里的内容,如果为空返回None
    def getText(self, html):
        if not type(html) is types.StringType:
            html = str(html)
        #提取出&lt;pre&gt;标签里的内容
        pattern = re.compile('&lt;pre.*?&gt;(.*?)&lt;/pre&gt;', re.S)
        match = re.search(pattern, html)
        #如果匹配成功
        if match:
            return match.group(1)
        else: 
            return None
    
    #传入最佳答案的HTML,分析出回答者和回答时间
    def getGoodAnswerInfo(self, html):
        pattern = re.compile('"answer_tip.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?&lt;span class="time.*?&gt;.*?\|(.*?)&lt;/span&gt;', re.S)
        match = re.search(pattern, html)
        #如果匹配,返回回答者和回答时间
        if match:
            time = match.group(2)
            time_pattern = re.compile('\d{2}\-\d{2}\-\d{2}', re.S)
            time_match = re.search(time_pattern, time)
            if not time_match:
                time = self.getCurrentDate()
            else:
                time = "20"+time
            return [match.group(1),time]
        else:
            return [None,None]
    
    #获得最佳答案
    def getGoodAnswer(self, page):
        soup = BeautifulSoup(page)
        text = soup.select("div.good_point div.answer_text pre")
        if len(text) &gt; 0:
            #获得最佳答案的内容
            ansText = self.getText(str(text[0]))
            ansText = self.tool.replace(ansText)
            #获得最佳答案的回答者信息
            info = soup.select("div.good_point div.answer_tip")
            ansInfo = self.getGoodAnswerInfo(str(info[0]))
            #将三者组合成一个List
            answer = [ansText, ansInfo[0], ansInfo[1],1]
            return answer
        else:
            #如果不存在最佳答案,那么就返回空
            return None
    
    #传入回答者HTML,分析出回答者,回答时间
    def getOtherAnswerInfo(self, html):
        if not type(html) is types.StringType:
            html = str(html)
        pattern = re.compile('"author_name.*?&gt;(.*?)&lt;/a&gt;.*?answer_t"&gt;(.*?)&lt;/span&gt;', re.S)
        match = re.search(pattern, html)
        #获得每一个回答的回答者信息和回答时间
        if match:
            time = match.group(2)
            time_pattern = re.compile('\d{2}\-\d{2}\-\d{2}', re.S)
            time_match = re.search(time_pattern, time)
            if not time_match:
                time = self.getCurrentDate()
            else:
                time = "20"+time
            return [match.group(1),time]
        else:
            return [None,None]
    
            
    #获得其他答案
    def getOtherAnswers(self, page):
        soup = BeautifulSoup(page)
        results =  soup.select("div.question_box li.clearfix .answer_info")
        #所有答案,包含好多个List,每个List包含了回答内容,回答者,回答时间
        answers = []
        for result in results:
            #获得回答内容
            ansSoup = BeautifulSoup(str(result))
            text = ansSoup.select(".answer_txt span pre")
            ansText = self.getText(str(text[0]))
            ansText = self.tool.replace(ansText)
            #获得回答者和回答时间
            info = ansSoup.select(".answer_tj")
            ansInfo = self.getOtherAnswerInfo(info[0])
            #将三者组合成一个List
            answer = [ansText, ansInfo[0], ansInfo[1],0]
            #加入到answers
            answers.append(answer)
        return answers
     
     #主函数
    def getAnswer(self, url):
        if not url:
            url = "http://iask.sina.com.cn/b/gQiuSNCMV.html"
        page = self.getPageByURL(url)
        good_ans = self.getGoodAnswer(page)
        other_ans = self.getOtherAnswers(page)
        return [good_ans,other_ans]


page = Page()
page.getAnswer(None)</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-2">2</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-4">4</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-6">6</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-8">8</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-10">10</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-12">12</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-14">14</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-16">16</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-18">18</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-20">20</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-22">22</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-24">24</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-26">26</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-28">28</div><div class="crayon-num" data-line="crayon-5645b71e9470e864033895-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9470e864033895-30">30</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e9470e864033895-1"><span class="crayon-c"># -*- coding:utf-8 -*-</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">urllib2</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">types</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-7"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">tool</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">bs4 </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">BeautifulSoup</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-9">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-10"><span class="crayon-c">#抓取分析某一问题和答案</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-11"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Page</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">tool</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">tool</span><span class="crayon-sy">.</span><span class="crayon-e">Tool</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#获取当前时间</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getCurrentDate</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'%Y-%m-%d'</span><span class="crayon-sy">,</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#获取当前时间</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'[%Y-%m-%d %H:%M:%S]'</span><span class="crayon-sy">,</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-23">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#通过页面的URL来获取页面的代码</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getPageByURL</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">url</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">request</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">Request</span><span class="crayon-sy">(</span><span class="crayon-v">url</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">urllib2</span><span class="crayon-sy">.</span><span class="crayon-e">urlopen</span><span class="crayon-sy">(</span><span class="crayon-v">request</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9470e864033895-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-e">read</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">decode</span><span class="crayon-sy">(</span><span class="crayon-s">"utf-8"</span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9470e864033895-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-k ">urllib2</span><span class="crayon-sy">.</span><span class="crayon-v">URLError</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-o">:</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0307 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e94718987882343" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
tool.py</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e94718987882343-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e94718987882343-1"><span class="crayon-v">tool</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e9471e427283683" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
#-*- coding:utf-8 -*-
import re

#处理页面标签类
class Tool:
    
    #将超链接广告剔除
    removeADLink = re.compile('&lt;div class="link_layer.*?&lt;/div&gt;')
    #去除img标签,1-7位空格,&amp;nbsp;
    removeImg = re.compile('&lt;img.*?&gt;| {1,7}|&amp;nbsp;')
    #删除超链接标签
    removeAddr = re.compile('&lt;a.*?&gt;|&lt;/a&gt;')
    #把换行的标签换为\n
    replaceLine = re.compile('&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;')
    #将表格制表&lt;td&gt;替换为\t
    replaceTD= re.compile('&lt;td&gt;')
    #将换行符或双换行符替换为\n
    replaceBR = re.compile('&lt;br&gt;&lt;br&gt;|&lt;br&gt;')
    #将其余标签剔除
    removeExtraTag = re.compile('&lt;.*?&gt;')
    #将多行空行删除
    removeNoneLine = re.compile('\n+')
    
    def replace(self,x):
        x = re.sub(self.removeADLink,"",x)
        x = re.sub(self.removeImg,"",x)
        x = re.sub(self.removeAddr,"",x)
        x = re.sub(self.replaceLine,"\n",x)
        x = re.sub(self.replaceTD,"\t",x)
        x = re.sub(self.replaceBR,"\n",x)
        x = re.sub(self.removeExtraTag,"",x)
        x = re.sub(self.removeNoneLine,"\n",x)
        #strip()将前后多余内容删除
        return x.strip()</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-2">2</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-4">4</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-6">6</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-8">8</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-10">10</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-12">12</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-14">14</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-16">16</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-18">18</div><div class="crayon-num" data-line="crayon-5645b71e9471e427283683-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9471e427283683-20">20</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e9471e427283683-1"><span class="crayon-c">#-*- coding:utf-8 -*-</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-2"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-4"><span class="crayon-c">#处理页面标签类</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-5"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Tool</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#将超链接广告剔除</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeADLink</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;div class="link_layer.*?&lt;/div&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#去除img标签,1-7位空格,&amp;nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeImg</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;img.*?&gt;| {1,7}|&amp;nbsp;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#删除超链接标签</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeAddr</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;a.*?&gt;|&lt;/a&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#把换行的标签换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceLine</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;tr&gt;|&lt;div&gt;|&lt;/div&gt;|&lt;/p&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#将表格制表&lt;td&gt;替换为\t</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceTD</span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;td&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#将换行符或双换行符替换为\n</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">replaceBR</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;br&gt;&lt;br&gt;|&lt;br&gt;'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9471e427283683-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#将其余标签剔除</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9471e427283683-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">removeExtraTag</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">re</span><span class="crayon-sy">.</span><span class="crayon-k ">compile</span><span class="crayon-sy">(</span><span class="crayon-s">'&lt;.*?&gt;'</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0077 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e94724862508431" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
mysql.py</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e94724862508431-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e94724862508431-1"><span class="crayon-v">mysql</span><span class="crayon-sy">.</span><span class="crayon-v">py</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0002 seconds] -->
<p></p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e9472a324568894" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
# -*- coding:utf-8 -*-


import MySQLdb
import time

class Mysql:
    
    #获取当前时间
    def getCurrentTime(self):
        return time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))
    
    #数据库初始化
    def __init__(self):
        try:
            self.db = MySQLdb.connect('ip','username','password','db_name')
            self.cur = self.db.cursor()
        except MySQLdb.Error,e:
             print self.getCurrentTime(),"连接数据库错误，原因%d: %s" % (e.args[0], e.args[1])

    #插入数据
    def insertData(self, table, my_dict):
         try:
             self.db.set_character_set('utf8')
             cols = ', '.join(my_dict.keys())
             values = '"," '.join(my_dict.values())
             sql = "INSERT INTO %s (%s) VALUES (%s)" % (table, cols, '"'+values+'"')
             try:
                 result = self.cur.execute(sql)
                 insert_id = self.db.insert_id()
                 self.db.commit()
                 #判断是否执行成功
                 if result:
                     return insert_id
                 else:
                     return 0
             except MySQLdb.Error,e:
                 #发生错误时回滚
                 self.db.rollback()
                 #主键唯一，无法插入
                 if "key 'PRIMARY'" in e.args[1]:
                     print self.getCurrentTime(),"数据已存在，未插入数据"
                 else:
                     print self.getCurrentTime(),"插入数据失败，原因 %d: %s" % (e.args[0], e.args[1])
         except MySQLdb.Error,e:
             print self.getCurrentTime(),"数据库错误，原因%d: %s" % (e.args[0], e.args[1])</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-2">2</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-4">4</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-6">6</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-8">8</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-10">10</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-12">12</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-14">14</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-16">16</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-18">18</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-20">20</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-22">22</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-24">24</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-26">26</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-28">28</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-30">30</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-32">32</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-34">34</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-36">36</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-38">38</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-40">40</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-42">42</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-44">44</div><div class="crayon-num" data-line="crayon-5645b71e9472a324568894-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e9472a324568894-46">46</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e9472a324568894-1"><span class="crayon-c"># -*- coding:utf-8 -*-</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-2">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e9472a324568894-3">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">MySQLdb</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-6">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e9472a324568894-7"><span class="crayon-t">class</span><span class="crayon-h"> </span><span class="crayon-v">Mysql</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#获取当前时间</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">strftime</span><span class="crayon-sy">(</span><span class="crayon-s">'[%Y-%m-%d %H:%M:%S]'</span><span class="crayon-sy">,</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">localtime</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#数据库初始化</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">__init__</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-16"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-e">connect</span><span class="crayon-sy">(</span><span class="crayon-s">'ip'</span><span class="crayon-sy">,</span><span class="crayon-s">'username'</span><span class="crayon-sy">,</span><span class="crayon-s">'password'</span><span class="crayon-sy">,</span><span class="crayon-s">'db_name'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">cur</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">cursor</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-v">Error</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"连接数据库错误，原因%d: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-20">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e9472a324568894-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">#插入数据</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">insertData</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">table</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">my_dict</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">set_character_set</span><span class="crayon-sy">(</span><span class="crayon-s">'utf8'</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">cols</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">my_dict</span><span class="crayon-sy">.</span><span class="crayon-e">keys</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">values</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'"," '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">my_dict</span><span class="crayon-sy">.</span><span class="crayon-e">values</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">sql</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"INSERT INTO %s (%s) VALUES (%s)"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">table</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">cols</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'"'</span><span class="crayon-o">+</span><span class="crayon-v">values</span><span class="crayon-o">+</span><span class="crayon-s">'"'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">cur</span><span class="crayon-sy">.</span><span class="crayon-e">execute</span><span class="crayon-sy">(</span><span class="crayon-v">sql</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-v">insert_id</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">insert_id</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">commit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">#判断是否执行成功</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">insert_id</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-35"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-v">Error</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">#发生错误时回滚</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-v">db</span><span class="crayon-sy">.</span><span class="crayon-e">rollback</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">#主键唯一，无法插入</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-s">"key 'PRIMARY'"</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"数据已存在，未插入数据"</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-43"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-44"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"插入数据失败，原因 %d: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5645b71e9472a324568894-45"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-v">MySQLdb</span><span class="crayon-sy">.</span><span class="crayon-v">Error</span><span class="crayon-sy">,</span><span class="crayon-v">e</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e9472a324568894-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-r">self</span><span class="crayon-sy">.</span><span class="crayon-e">getCurrentTime</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-s">"数据库错误，原因%d: %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">e</span><span class="crayon-sy">.</span><span class="crayon-v">args</span><span class="crayon-sy">[</span><span class="crayon-cn">1</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0111 seconds] -->
<p>数据库建表SQL如下：</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e94730117234516" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div><span class="crayon-language">PgSQL</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
CREATE TABLE IF NOT EXISTS `iask_answers` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '自增ID',
  `text` text NOT NULL COMMENT '回答内容',
  `question_id` int(18) NOT NULL COMMENT '问题ID',
  `answerer` varchar(255) NOT NULL COMMENT '回答者',
  `date` varchar(255) NOT NULL COMMENT '回答时间',
  `is_good` int(11) NOT NULL COMMENT '是否是最佳答案',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;

CREATE TABLE IF NOT EXISTS `iask_questions` (
  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT '问题ID',
  `text` text NOT NULL COMMENT '问题内容',
  `questioner` varchar(255) NOT NULL COMMENT '提问者',
  `date` date NOT NULL COMMENT '提问时间',
  `ans_num` int(11) NOT NULL COMMENT '回答数量',
  `url` varchar(255) NOT NULL COMMENT '问题链接',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e94730117234516-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-2">2</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-4">4</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-6">6</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-8">8</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-10">10</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-12">12</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-14">14</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-16">16</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5645b71e94730117234516-18">18</div><div class="crayon-num" data-line="crayon-5645b71e94730117234516-19">19</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e94730117234516-1"><span class="crayon-st">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-st">IF</span><span class="crayon-h"> </span><span class="crayon-r">NOT</span><span class="crayon-h"> </span><span class="crayon-st">EXISTS</span><span class="crayon-h"> </span>`iask_answers`<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-2"><span class="crayon-h">&nbsp;&nbsp;</span>`id`<span class="crayon-h"> </span><span class="crayon-t">int</span>(11)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span>AUTO_INCREMENT<span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'自增ID'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-3"><span class="crayon-h">&nbsp;&nbsp;</span>`<span class="crayon-t">text</span>`<span class="crayon-h"> </span><span class="crayon-t">text</span><span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'回答内容'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-4"><span class="crayon-h">&nbsp;&nbsp;</span>`question_id`<span class="crayon-h"> </span><span class="crayon-t">int</span>(18)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'问题ID'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-5"><span class="crayon-h">&nbsp;&nbsp;</span>`answerer`<span class="crayon-h"> </span><span class="crayon-t">varchar</span>(255)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'回答者'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-6"><span class="crayon-h">&nbsp;&nbsp;</span>`<span class="crayon-t">date</span>`<span class="crayon-h"> </span><span class="crayon-t">varchar</span>(255)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'回答时间'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-7"><span class="crayon-h">&nbsp;&nbsp;</span>`is_good`<span class="crayon-h"> </span><span class="crayon-t">int</span>(11)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'是否是最佳答案'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-8"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">PRIMARY</span><span class="crayon-h"> </span><span class="crayon-r">KEY</span><span class="crayon-h"> </span>(`id`)</div><div class="crayon-line" id="crayon-5645b71e94730117234516-9">)<span class="crayon-h"> </span>ENGINE<span class="crayon-o">=</span>InnoDB<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">DEFAULT</span><span class="crayon-h"> </span>CHARSET<span class="crayon-o">=</span>utf8;</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-10">&nbsp;</div><div class="crayon-line" id="crayon-5645b71e94730117234516-11"><span class="crayon-st">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-st">IF</span><span class="crayon-h"> </span><span class="crayon-r">NOT</span><span class="crayon-h"> </span><span class="crayon-st">EXISTS</span><span class="crayon-h"> </span>`iask_questions`<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-12"><span class="crayon-h">&nbsp;&nbsp;</span>`id`<span class="crayon-h"> </span><span class="crayon-t">int</span>(11)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span>AUTO_INCREMENT<span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'问题ID'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-13"><span class="crayon-h">&nbsp;&nbsp;</span>`<span class="crayon-t">text</span>`<span class="crayon-h"> </span><span class="crayon-t">text</span><span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'问题内容'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-14"><span class="crayon-h">&nbsp;&nbsp;</span>`questioner`<span class="crayon-h"> </span><span class="crayon-t">varchar</span>(255)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'提问者'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-15"><span class="crayon-h">&nbsp;&nbsp;</span>`<span class="crayon-t">date</span>`<span class="crayon-h"> </span><span class="crayon-t">date</span><span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'提问时间'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-16"><span class="crayon-h">&nbsp;&nbsp;</span>`ans_num`<span class="crayon-h"> </span><span class="crayon-t">int</span>(11)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'回答数量'</span>,</div><div class="crayon-line" id="crayon-5645b71e94730117234516-17"><span class="crayon-h">&nbsp;&nbsp;</span>`url`<span class="crayon-h"> </span><span class="crayon-t">varchar</span>(255)<span class="crayon-h"> </span><span class="crayon-r">NOT NULL</span><span class="crayon-h"> </span><span class="crayon-st">COMMENT</span><span class="crayon-h"> </span><span class="crayon-s">'问题链接'</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-5645b71e94730117234516-18"><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">PRIMARY</span><span class="crayon-h"> </span><span class="crayon-r">KEY</span><span class="crayon-h"> </span>(`id`)</div><div class="crayon-line" id="crayon-5645b71e94730117234516-19">)<span class="crayon-h"> </span>ENGINE<span class="crayon-o">=</span>InnoDB<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">DEFAULT</span><span class="crayon-h"> </span>CHARSET<span class="crayon-o">=</span>utf8;</div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0055 seconds] -->
<p>运行的时候执行如下命令即可</p><!-- Crayon Syntax Highlighter v2.7.1 -->

		<div id="crayon-5645b71e94736237099132" class="crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-mac print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; float: left; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title"></span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="切换是否显示行编号"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="纯文本显示代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="切换自动换行"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="点击展开代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="复制代码"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="在新窗口中显示代码"><div class="crayon-button-icon"></div></div></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea  class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
nohup python spider.py &amp;</textarea></div>
			<div class="crayon-main" style="">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5645b71e94736237099132-1">1</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5645b71e94736237099132-1"><span class="crayon-e">nohup </span><span class="crayon-e">python </span><span class="crayon-v">spider</span><span class="crayon-sy">.</span><span class="crayon-v">py</span><span class="crayon-h"> </span><span class="crayon-o">&amp;</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0003 seconds] -->
<p>代码写的不好，仅供大家学习参考使用，如有问题，欢迎留言交流。</p>
<h2>运行结果查看</h2>
<p>我们把PHP文件和log文件放在同一目录下，运行PHP文件，便可以看到如下的内容：</p>
<p><a href="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png"><img class="alignnone size-full wp-image-2018" src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" alt="20150908222744" width="1294" height="575" /></a></p>
<p>小伙伴们赶快试一下吧。</p>
<p>转载请注明：<a href="http://blog.cuiqingcai.com">静觅</a> &raquo; <a href="http://blog.cuiqingcai.com/1972.html">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a></p>

      
<div class="article-social">
			<a href="javascript:;" data-action="ding" data-id="1972" id="Addlike" class="action"><i class="fa fa-heart-o"></i>喜欢 (<span class="count">10</span>)</a><span class="or">or</span><span class="action action-share bdsharebuttonbox"><i class="fa fa-share-alt"></i>分享 (<span class="bds_count" data-cmd="count" title="累计分享0次">0</span>)<div class="action-popover"><div class="popover top in"><div class="arrow"></div><div class="popover-content"><a href="#" class="sinaweibo fa fa-weibo" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_qzone fa fa-star" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="tencentweibo fa fa-tencent-weibo" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="qq fa fa-qq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_renren fa fa-renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin fa fa-weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_more fa fa-ellipsis-h" data-cmd="more"></a></div></div></div></span>	
</div>
	</article>	
				<div style="background:#fff;padding-bottom:20px;font-size:14px;">
			<p style="text-align: center;margin-bottom:20px;padding:0px 20px">您的支持是博主写作最大的动力，如果您喜欢我的文章，感觉我的文章对您有帮助，请狠狠点击下面的</p>
			<p style="text-align: center;"><a href="http://cuiqingcai.com/donate"> <input style="width: 310px; margin: 10px auto 0px; background-color: #f58a87; color: #ffffff; height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" type="button" value="我要小额赞助" /></a>
		</div>
		<footer class="article-footer">
			<div class="article-tags"><i class="fa fa-tags"></i><a href="http://blog.cuiqingcai.com/tag/python" rel="tag">Python</a><a href="http://blog.cuiqingcai.com/tag/%e7%88%ac%e8%99%ab" rel="tag">爬虫</a></div>		</footer>
	<nav class="article-nav">
			<span class="article-nav-prev"><i class="fa fa-angle-double-left"></i> <a href="http://blog.cuiqingcai.com/1981.html" rel="prev">Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法</a></span>
			<span class="article-nav-next"><a href="http://blog.cuiqingcai.com/2036.html" rel="next">Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤</a>  <i class="fa fa-angle-double-right"></i></span>
		</nav>

		<div class="related_top">
			<div class="related_posts"><ul class="related_img">

		<li class="related_box"  >
		<a href="http://blog.cuiqingcai.com/2083.html" title="自己动手实现山东大学QLSC_STU无线网络掉线后自动重连" target="_blank">
<img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/09/wallpaper_5265780.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="自己动手实现山东大学QLSC_STU无线网络掉线后自动重连" />	<br><span class="r_title">自己动手实现山东大学QLSC_STU无线网络掉线后自动重连</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://blog.cuiqingcai.com/1707.html" title="Python中ValueError: invalid literal for int() with base 10 的实用解决办法" target="_blank">
<img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/wallpaper_5263464.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python中ValueError: invalid literal for int() with base 10 的实用解决办法" />	<br><span class="r_title">Python中ValueError: invalid literal for int() with base 10 的实用解决办法</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://blog.cuiqingcai.com/1319.html" title="Python爬虫入门八之Beautiful Soup的用法" target="_blank">
<img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/03/wallpaper_52546561.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python爬虫入门八之Beautiful Soup的用法" />	<br><span class="r_title">Python爬虫入门八之Beautiful Soup的用法</span></a>
		</li>
	
		<li class="related_box"  >
		<a href="http://blog.cuiqingcai.com/1076.html" title="Python爬虫实战五之模拟登录淘宝并获取所有订单" target="_blank">
<img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5226152.jpg&h=110&w=185&q=90&zc=1&ct=1" alt="Python爬虫实战五之模拟登录淘宝并获取所有订单" />	<br><span class="r_title">Python爬虫实战五之模拟登录淘宝并获取所有订单</span></a>
		</li>
	</ul>

<div class="relates">
<ul>
<li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/2083.html">自己动手实现山东大学QLSC_STU无线网络掉线后自动重连</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/1707.html">Python中ValueError: invalid literal for int() with base 10 的实用解决办法</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/1319.html">Python爬虫入门八之Beautiful Soup的用法</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/1076.html">Python爬虫实战五之模拟登录淘宝并获取所有订单</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/1052.html">Python爬虫学习系列教程</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/1001.html">Python爬虫实战四之抓取淘宝MM照片</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/997.html">Python爬虫实战三之计算大学本学期绩点</a></li><li><i class="fa fa-minus"></i><a href="http://blog.cuiqingcai.com/993.html">Python爬虫实战二之爬取百度贴吧帖子</a></li>
</ul></div></div>		</div>
						<a name="comments"></a>

<div class="ds-thread" data-thread-key="1972" data-author-key="1" data-title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" data-url="http://blog.cuiqingcai.com/1972.html"></div>

<script type="text/javascript">
	if (typeof DUOSHUO !== 'undefined')
		DUOSHUO.EmbedThread('.ds-thread');
</script>
	<div id="ds-ssr">

		
            <ol id="commentlist">
                		<li class="comment even thread-even depth-1" id="li-comment-868">
			<article id="comment-868" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">leo</span> on <a rel="nofollow" href="http://blog.cuiqingcai.com/1972.html/comment-page-1#comment-868"><time pubdate datetime="2015-09-28T21:28:11+00:00">2015年9月28日 at 下午9:28</time></a> <span class="says">said:</span>					</cite><!-- .comment-author .vcard -->
				</footer>
	
				<div class="comment-content"><p>微信怎么破？</p>
</div>
				
			</article><!-- #comment-## -->
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-787">
			<article id="comment-787" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn">111</span> on <a rel="nofollow" href="http://blog.cuiqingcai.com/1972.html/comment-page-1#comment-787"><time pubdate datetime="2015-09-10T21:19:18+00:00">2015年9月10日 at 下午9:19</time></a> <span class="says">said:</span>					</cite><!-- .comment-author .vcard -->
				</footer>
	
				<div class="comment-content"><p>大哥。。。。您啥时候做知乎的模拟登陆啊。。。。我表示脑袋疼 验证一直不通过</p>
</div>
				
			</article><!-- #comment-## -->
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="li-comment-783">
			<article id="comment-783" class="comment">
				<footer class="comment-meta">
					<cite class="comment-author vcard">
						<span class="fn"><a href='http://t.qq.com/zhuke2345' rel='external nofollow' class='url'>朱可</a></span> on <a rel="nofollow" href="http://blog.cuiqingcai.com/1972.html/comment-page-1#comment-783"><time pubdate datetime="2015-09-09T15:20:45+00:00">2015年9月9日 at 下午3:20</time></a> <span class="says">said:</span>					</cite><!-- .comment-author .vcard -->
				</footer>
	
				<div class="comment-content"><p>博主今年大四么？</p>
</div>
				
			</article><!-- #comment-## -->
		</li><!-- #comment-## -->
            </ol>

		            
    </div>			</div>
</div>
<aside class="sidebar">	
<div class="widget widget_text"><div class="textwidget"><div class="social">

<a href="http://weibo.com/u/2830678474" rel="external nofollow" title="新浪微博" target="_blank"><i class="sinaweibo fa fa-weibo"></i></a><a  href="http://t.qq.com/CQCcqc123456?preview" rel="external nofollow" title="腾讯微博" target="_blank"><i class="tencentweibo fa fa-tencent-weibo"></i></a><a class="weixin"><i class="weixins fa fa-weixin"></i><div class="weixin-popover"><div class="popover bottom in"><div class="arrow"></div><div class="popover-title"></div><div class="popover-content"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/img/weixin.gif" ></div></div></div></a>
<a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=cqc@cuiqingcai.com" rel="external nofollow" title="Email" target="_blank"><i class="email fa fa-envelope-o"></i></a><a href="?feed=rss2" rel="external nofollow" target="_blank"  title="订阅本站"><i class="rss fa fa-rss"></i></a>
</div></div></div>

<div class="widget widget_archive"><div class="title"><h2>文章归档</h2></div>		<ul>
	<li><a href='http://blog.cuiqingcai.com/date/2015/11'>2015年十一月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/10'>2015年十月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/09'>2015年九月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/08'>2015年八月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/07'>2015年七月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/06'>2015年六月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/05'>2015年五月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/04'>2015年四月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/03'>2015年三月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/02'>2015年二月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2015/01'>2015年一月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2014/12'>2014年十二月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2014/11'>2014年十一月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2014/10'>2014年十月</a></li>
	<li><a href='http://blog.cuiqingcai.com/date/2014/09'>2014年九月</a></li>
		</ul>
</div><div class="widget widget_text"><div class="title"><h2>原创游戏</h2></div>			<div class="textwidget"><div class="taobaotextad">
<p style="
    margin-left: 20px;
    color: #00a67c;
">BallEscape丨博主开发的一款休闲益智虐心游戏 </p><p style="
    margin-left: 10px;
">
<a href="http://res.cuiqingcai.com/ballescape/">
<input type="button" value="了解更多" style="width: 310px; margin: 10px auto 0px; background-color: rgb(245, 138, 135); color: rgb(255, 255, 255); height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" onmouseover="this.style.backgroundColor='rgb(252, 125, 121)'" onmouseout="this.style.backgroundColor='#F58A87'"></a>
</p></div></div>
		</div><div class="widget d_postlist"><div class="title"><h2>猜你喜欢</h2></div><ul><li><a href="http://blog.cuiqingcai.com/990.html" title="Python爬虫实战一之爬取糗事百科段子" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5228661.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战一之爬取糗事百科段子" /></span><span class="text">Python爬虫实战一之爬取糗事百科段子</span><span class="muted">2015-02-17</span><span class="muted"><span class="ds-thread-count" data-thread-key="990" data-replace="1">123评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/1001.html" title="Python爬虫实战四之抓取淘宝MM照片" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5270641.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战四之抓取淘宝MM照片" /></span><span class="text">Python爬虫实战四之抓取淘宝MM照片</span><span class="muted">2015-02-20</span><span class="muted"><span class="ds-thread-count" data-thread-key="1001" data-replace="1">81评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/1076.html" title="Python爬虫实战五之模拟登录淘宝并获取所有订单" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5226152.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战五之模拟登录淘宝并获取所有订单" /></span><span class="text">Python爬虫实战五之模拟登录淘宝并获取所有订单</span><span class="muted">2015-02-24</span><span class="muted"><span class="ds-thread-count" data-thread-key="1076" data-replace="1">79评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/993.html" title="Python爬虫实战二之爬取百度贴吧帖子" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5265936.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战二之爬取百度贴吧帖子" /></span><span class="text">Python爬虫实战二之爬取百度贴吧帖子</span><span class="muted">2015-02-17</span><span class="muted"><span class="ds-thread-count" data-thread-key="993" data-replace="1">51评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/1052.html" title="Python爬虫学习系列教程" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5254665-e1424499272248.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫学习系列教程" /></span><span class="text">Python爬虫学习系列教程</span><span class="muted">2015-02-21</span><span class="muted"><span class="ds-thread-count" data-thread-key="1052" data-replace="1">44评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/968.html" title="Python爬虫入门六之Cookie的使用" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5258536-1.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门六之Cookie的使用" /></span><span class="text">Python爬虫入门六之Cookie的使用</span><span class="muted">2015-02-15</span><span class="muted"><span class="ds-thread-count" data-thread-key="968" data-replace="1">37评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/997.html" title="Python爬虫实战三之计算大学本学期绩点" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5265978.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫实战三之计算大学本学期绩点" /></span><span class="text">Python爬虫实战三之计算大学本学期绩点</span><span class="muted">2015-02-20</span><span class="muted"><span class="ds-thread-count" data-thread-key="997" data-replace="1">32评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/912.html" title="Python爬虫进阶一之爬虫框架Scrapy安装配置" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/d52a2834349b033b20721ee016ce36d3d539bd16.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫进阶一之爬虫框架Scrapy安装配置" /></span><span class="text">Python爬虫进阶一之爬虫框架Scrapy安装配置</span><span class="muted">2015-02-17</span><span class="muted"><span class="ds-thread-count" data-thread-key="912" data-replace="1">29评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/1319.html" title="Python爬虫入门八之Beautiful Soup的用法" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/03/wallpaper_52546561.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门八之Beautiful Soup的用法" /></span><span class="text">Python爬虫入门八之Beautiful Soup的用法</span><span class="muted">2015-03-11</span><span class="muted"><span class="ds-thread-count" data-thread-key="1319" data-replace="1">26评论</span></span></a></li>
<li><a href="http://blog.cuiqingcai.com/977.html" title="Python爬虫入门七之正则表达式" ><span class="thumbnail"><img src="http://blog.cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5270713.jpg&h=64&w=100&q=90&zc=1&ct=1" alt="Python爬虫入门七之正则表达式" /></span><span class="text">Python爬虫入门七之正则表达式</span><span class="muted">2015-02-15</span><span class="muted"><span class="ds-thread-count" data-thread-key="977" data-replace="1">21评论</span></span></a></li>
</ul></div><div class="widget widget_text"><div class="title"><h2>我要投稿</h2></div>			<div class="textwidget"><div class="taobaotextad">
<p style="
    margin-left: 20px;
    color: #00a67c;
">想让自己的文章出现在这里吗?赶快注册投稿吧！</p><p style="
    margin-left: 10px;
">
<a href="http://cuiqingcai.com/wp-login.php?action=register">
<input type="button" value="点我投稿" style="width: 310px; margin: 10px auto 0px; background-color: rgb(245, 138, 135); color: rgb(255, 255, 255); height: 40px; border: none; font-family: 'Microsoft Yahei'; font-size: 16px; letter-spacing: 2px;" onmouseover="this.style.backgroundColor='rgb(252, 125, 121)'" onmouseout="this.style.backgroundColor='#F58A87'"></a>
</p></div></div>
		</div><div class="widget d_tag"><div class="title"><h2>标签云</h2></div><div class="d_tags"><a title="26个话题" href="http://blog.cuiqingcai.com/tag/php">PHP (26)</a><a title="20个话题" href="http://blog.cuiqingcai.com/tag/python">Python (20)</a><a title="16个话题" href="http://blog.cuiqingcai.com/tag/%e7%88%ac%e8%99%ab">爬虫 (16)</a><a title="14个话题" href="http://blog.cuiqingcai.com/tag/js">JS (14)</a><a title="10个话题" href="http://blog.cuiqingcai.com/tag/opengl">OpenGL (10)</a><a title="9个话题" href="http://blog.cuiqingcai.com/tag/html">HTML (9)</a><a title="7个话题" href="http://blog.cuiqingcai.com/tag/linux">Linux (7)</a><a title="6个话题" href="http://blog.cuiqingcai.com/tag/jquery">jQuery (6)</a><a title="6个话题" href="http://blog.cuiqingcai.com/tag/winpcap">Winpcap (6)</a><a title="5个话题" href="http://blog.cuiqingcai.com/tag/wordpress">WordPress (5)</a><a title="4个话题" href="http://blog.cuiqingcai.com/tag/git">Git (4)</a><a title="4个话题" href="http://blog.cuiqingcai.com/tag/security">Security (4)</a><a title="3个话题" href="http://blog.cuiqingcai.com/tag/java">Java (3)</a><a title="3个话题" href="http://blog.cuiqingcai.com/tag/mysql">Mysql (3)</a><a title="3个话题" href="http://blog.cuiqingcai.com/tag/net">Net (3)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/cocos2d-x">Cocos2d-x (2)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/jsp">JSP (2)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/matlab">Matlab (2)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/bootstrap">Bootstrap (2)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/photoshop">Photoshop (2)</a><a title="2个话题" href="http://blog.cuiqingcai.com/tag/css">CSS (2)</a><a title="1个话题" href="http://blog.cuiqingcai.com/tag/json">Json (1)</a><a title="1个话题" href="http://blog.cuiqingcai.com/tag/redis">Redis (1)</a><a title="1个话题" href="http://blog.cuiqingcai.com/tag/less">LESS (1)</a><a title="1个话题" href="http://blog.cuiqingcai.com/tag/nginx">Nginx (1)</a></div></div><div class="widget widget_links"><div class="title"><h2>友情链接</h2></div>
	<ul class='xoxo blogroll'>
<li><a href="http://www.anotherhome.net" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/03/wallpaper_5264963.jpg"  alt="Anotherhome "  /> Anotherhome</a></li>
<li><a href="http://zhouchenwen.com" rel="acquaintance" target="_blank"><img src="http://zhouchenwen-wordpress.stor.sinaapp.com/uploads/2015/03/beatiful.jpg"  alt="ColdCoder "  /> ColdCoder</a></li>
<li><a href="http://www.findspace.name" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5254666.jpg"  alt="Findspace "  /> Findspace</a></li>
<li><a href="http://blog.hickwu.com/" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/wallpaper_5270857.jpg"  alt="Hick "  /> Hick</a></li>
<li><a href="http://www.nopcn.com" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/07/wallpaper_5263470.jpg"  alt="nopcommerce "  /> nopcommerce</a></li>
<li><a href="http://www.atrail.cn/" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5254665-e1424499272248.jpg"  alt="从前以后 "  /> 从前以后</a></li>
<li><a href="http://www.superqq.com/"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/05/wallpaper_5265810.jpg"  alt="刚刚在线 "  /> 刚刚在线</a></li>
<li><a href="http://www.lvtao.net" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5228675.jpg"  alt="吕滔博客 "  /> 吕滔博客</a></li>
<li><a href="http://www.fddcn.cn" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/wallpaper_5228669.jpg"  alt="奋斗的承诺 "  /> 奋斗的承诺</a></li>
<li><a href="http://www.zuilizhi.net/" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/07/wallpaper_5247812.jpg"  alt="最励志网 "  /> 最励志网</a></li>
<li><a href="http://www.lishengcn.cn/" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/02/wallpaper_5266007.jpg"  alt="李胜的脚步 "  /> 李胜的脚步</a></li>
<li><a href="http://liaoyuming.cn" rel="acquaintance" target="_blank"><img src="http://liaoyuming.cn/wp-content/uploads/2015/03/3-750x300.jpg"  alt="永远站 "  /> 永远站</a></li>
<li><a href="http://www.hubwiz.com" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/08/wallpaper_5269088.jpg"  alt="汇智网 "  /> 汇智网</a></li>
<li><a href="http://www.zoeys.cn/" target="_blank"><img src="http://qiniu.cuiqingcai.com/wp-content/uploads/2015/10/wallpaper_5234204-e1446021079981.jpg"  alt="糊糊 "  /> 糊糊</a></li>
<li><a href="http://www.leyle.com/" target="_blank"><img src="http://cuiqingcai.com/wp-content/themes/Yusi/timthumb.php?src=http://qiniu.cuiqingcai.com/wp-content/uploads/2015/04/wallpaper_5259137-1.jpg&amp;h=123&amp;w=200&amp;q=90&amp;zc=1&amp;ct=1"  alt="遗落岛 "  /> 遗落岛</a></li>

	</ul>
</div>
<div class="widget widget_text"><div class="title"><h2>本站热门</h2></div>			<div class="textwidget"><div class = "taobaotextad" style="margin-top:-10px;"><script>document.write(unescape('%3Cdiv id="hm_t_59089"%3E%3C/div%3E%3Cscript charset="utf-8" src="http://crs.baidu.com/t.js?siteId=3ef185224776ec2561c9f7066ead4f24&planId=59089&async=0&referer=') + encodeURIComponent(document.referrer) + '&title=' + encodeURIComponent(document.title) + '&rnd=' + (+new Date) + unescape('"%3E%3C/script%3E'));</script>
</div></div>
		</div><div class="widget widget_text"><div class="title"><h2>休闲一下</h2></div>			<div class="textwidget"><div  style = "text-align: center" width="100%"><a href = "http://res.cuiqingcai.com/2048">
<img src = "http://cuiqingcai.com/wp-content/uploads/2014/11/2048.jpg" style="margin:10px 0 10px 0" alt = "2048游戏"/>
</a></div></div>
		</div><div class="widget widget_text"><div class="title"><h2>新浪微博</h2></div>			<div class="textwidget"><iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=1&isFans=1&uid=2830678474&verifier=7468dc7b&dpc=1"></iframe></div>
		</div><div class="widget widget_text"><div class="title"><h2>精品推荐</h2></div>			<div class="textwidget"><div class = "taobaotextad">
<script type="text/javascript">
var cpro_id="u1974136";
(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"338",rsi1:"330",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"0",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"",rss2:"#00a67c",titSU:"0",ptbg:"70",piw:"130",pih:"80",ptp:"0"}
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div></div>
		</div></aside></section>
<footer class="footer">
    <div class="footer-inner">
        <div class="copyright pull-left">
         <a href="http://blog.cuiqingcai.com " title="静觅">静觅</a> 版权所有丨采用<a href="http://yusi123.com/"> 欲思 </a>主题丨基于<a href="http://cn.wordpress.org/" title="WordPress"> WordPress </a>构建   © 2015丨托管于 <a rel="nofollow" target="_blank" href="http://www.aliyun.com/">阿里云主机</a> & <a rel="nofollow" target="_blank" href="http://www.qiniu.com/">七牛云存储 </a>丨鲁ICP备14030596号
		 <div>
			<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253486800'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s4.cnzz.com/z_stat.php%3Fid%3D1253486800%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
		 </div>
		</div>
        
    </div>
</footer>

<script type='text/javascript'>
/* <![CDATA[ */
var viewsCacheL10n = {"admin_ajax_url":"http:\/\/blog.cuiqingcai.com\/wp-admin\/admin-ajax.php","post_id":"1972"};
/* ]]> */
</script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/plugins/wp-postviews/postviews-cache.js?ver=1.68'></script>
<script type='text/javascript' src='http://cuiqingcai.com/wp-content/themes/Yusi/js/jquery.js?ver=1.0'></script>
<script>with(document)0[(getElementsByTagName("head")[0]||body).appendChild(createElement("script")).src="http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion="+~(-new Date()/36e5)];</script><!-- xuanfu -->
 <script type="text/javascript">
    /*300*25 创建于 2015-02-23*/
    var cpro_id = "u1959047";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/s.js" type="text/javascript"></script>
<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3ef185224776ec2561c9f7066ead4f24' type='text/javascript'%3E%3C/script%3E"));
</script>

</body>
</html>
<!-- Dynamic page generated in 0.509 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2015-11-13 18:10:39 -->

<!-- super cache -->